<div class='box' >
	<h2><%= @record.title %></h2>
	<h3>By <%= User.find(@record.user_id).username %></h3>
	<p><%= simple_format(@record.description) %></p>
	<% if !@record.init_attempt %>
		<p class='warning'>You have not attempted this record yet. Only you can see it. You must make an attempt below before it is public.</p>
	<% end %>
</div>

<div class='box'>
	<a href='/attempt/new?record_id=<%= @record.id %>' style='width: 100%'><button style='width: 100%'>Attempt this record!</button></a>
</div>

<div class='space'></div>

<% @record.attempts.each do |attempt| %>
	<div class='box' >
		<h2><%= User.find(attempt.user_id).username %> attempted at <%= attempt.created_at %></h2>
		<% if attempt.success.present? %>
			<% if attempt.success %>
				<p>and succeeded!</p>
			<% else %>
			  <p>and failed</p>
			<% end %>
		<% else %>
			<p>status pending</p>
		<% end %>
		<% if @current_holder_id == attempt.id %>
			<p>Current Holder</p>
		<% end %>
		<button id='<%= attempt.id %>' onclick='showVideo(this.id)'>Show Video</button>
		<div id='videoContainer<%= attempt.id %>'></div>
	</div>
	<div class='space'></div>
<% end %>

<script type="text/javascript">
	function showVideo(id) {
		let videoContainer = document.getElementById('videoContainer' + id);
		$.ajax({
      type: "GET", 
      url: '/video/' + id,
      success: function(data) {
      	videoContainer.innerHTML = '<video src=\'' + data.video + '\'controls>';
      }
    });
	}
</script>